@model ServiceDirectoryTemplate.Models.Department
@{
    //Layout = "../Shared/LayOutNull.cshtml";
}
@{
    ViewBag.Title = "Amend Department";
}
<script language="javascript" type="text/javascript">
$(document).ready(function () {
    $("#AddDep").submit(function (e) {
            var form=this;
            if ($(this).valid()) {
                if (form.pendding.value == 1)
                    return false;
                var Address1 = form.AddressLine1.value;
                var PostCode = form.PostCode.value;
                var Town = form.CityTown.value;
                var County = form.County.value;
                var CountryID = form.CountryID.value;
                $.ajax({
                    type: "POST",
                    url: "/Address/AddressIsNew",
                    data: ({ Address1: Address1, PostCode: PostCode, Town: Town, County: County, CountryID: CountryID }),
                    success: function (data) {
                        form.pendding.value=1;
                        if (data == "true") {
                            var re = confirm("Address Details cannot be confirmed\nDo you wish to enter Unconfirmed Address Data");
                            if (re == true) {
                                form.submit();
                            } else {
                                form.AddressLine1.value = "";
                                form.PostCode.value = "";
                                form.CityTown.value = "";
                                form.County.value = "";
                                form.CountryID.selectedIndex = 0;
                                form.AddressLine1.focus();
                            }
                        }
                        else {
                            form.submit();
                        }
                        form.pendding.value=0;
                    }
                });
            }
            return false;
        });
    $("#AddDep").validate({
        errorLabelContainer: $("div.error"),
        rules: {
            DepName: { required: true, maxlength: 100, remote: { url: "/Department/CheckUnique1/@Model.DepID" } },
            DepShortDescription: { required: true, maxlength: 100 },
            TypeOfBusinessID: { required: true },
            AddressLine1: { required: true }
        },
        messages: {
            DepName: {
                required: "Please input the Department Name",
                maxlength: "Department Name is too long",
                remote: "Please input other Department Name (the cause is duplicate)"
            },
            DepShortDescription: {
                required: "Please input the Short Description",
                maxlength: "Short Description is too long"
            },
            TypeOfBusinessID: { required: "Please choose the Bussiness Type" },
            AddressLine1: { required: "Please input the Address Line" }
        }
    });
});
function ChangeAddr() {
    document.AddDep.CopyAddr[0].checked=false;
    document.AddDep.CopyAddr[1].checked=false;
}
function CopyAddress() {
    if (document.AddDep.CopyAddr[0].checked == true) {
        document.AddDep.AddressLine1.value = document.AddDep.OrgAddr1.value;
        document.AddDep.AddressLine2.value = document.AddDep.OrgAddr2.value;
        document.AddDep.AddressLine3.value = document.AddDep.OrgAddr3.value;
        document.AddDep.PostCode.value = document.AddDep.OrgCode.value;
        document.AddDep.CityTown.value = document.AddDep.OrgTown.value;
        document.AddDep.County.value = document.AddDep.OrgCounty.value;
        for (var i = 0; i < document.AddDep.CountryID.length; i++) {
            if (document.AddDep.CountryID[i].value == document.AddDep.OrgCountry.value)
                document.AddDep.CountryID[i].selected = true;
        }
    }
    else if(document.AddDep.CopyAddr[1].checked == true) {
        document.AddDep.AddressLine1.value = document.AddDep.ParAddr1.value;
        document.AddDep.AddressLine2.value = document.AddDep.ParAddr2.value;
        document.AddDep.AddressLine3.value = document.AddDep.ParAddr3.value;
        document.AddDep.PostCode.value = document.AddDep.ParCode.value;
        document.AddDep.CityTown.value = document.AddDep.ParTown.value;
        document.AddDep.County.value = document.AddDep.ParCounty.value;
        for (var i = 0; i < document.AddDep.CountryID.length; i++) {
            if (document.AddDep.CountryID[i].value == document.AddDep.ParCountry.value)
                document.AddDep.CountryID[i].selected = true;
        }
    }
}
	</script>
    
<div class="container-right">
		<div class="table-content">
			<p style="text-align:left"><a title="List all Organisation" href="/Organisation/List">Organisation </a> &gt; <a title="List all Organisation" href="/Directorate/List">Directorate</a> &gt;</p>
			<p style="color:#69a017;font-size:large;margin-bottom:10px;text-align:left">Department Details</p>
			<p>
			
			
			
			</p>
            <div id="tabs">
         <form action="/Department/Update/@Model.DepID" name="AddDep" id="AddDep" method="post">
         <input type="hidden" name="pendding" value="0" />
            <span style="float:right;margin-right:10px">
            <input type="button" onclick="window.location='/Department/MarkInactivate/@Model.DepID'" value="In-activate" />
			<input type="submit" value="Save" /> 
			<a title="Return to amend Directorate" href="/Directorate/Amend/@Model.DirID#tabs-2"><input type="button" value="Back" /></a> 
			</span>
            <input type="hidden" name="DirID" value="@Html.DisplayFor(model => model.DirID)" />
			
			<ul>
				<li><a href="#tabs-1">Details</a></li>
                <li><a href="#tabs-2">Teams</a></li>
			</ul>
			<div id="tabs-1">
			<table class="table-only-border-out" width="750px">
				<tr>
					<td width="130px">Department Name &nbsp;<span style="color:red">*</span></td>
					<td width="240px"><input class="standar-textbox" type="text" name="DepName" value="@Html.DisplayFor(model => model.DepName)" /></td>
					<td width="130px">Type of Business<span style="color:red">*</span></td>
					<td><input class="lookup-textbox" type="text" name="TypeOfBusinessID"  value="@Html.DisplayFor(model => model.TypeOfBusiness)" readonly="readonly"/> <a onclick="SICLookUp('TypeOfBusinessID', 'DepSICCode')" class="link" style="color:Blue">Lookup</a></td>
				</tr>
				
				<tr>
					<td >Department Short Description &nbsp;<span style="color:red">*</span></td>
					<td rowspan="2"><textarea class="standar-textbox" name="DepShortDescription">@Html.DisplayFor(model => model.DepShortDescription)</textarea></td>
					<td style="vertical-align:top">SIC Code</td>
					<td style="vertical-align:top"><input class="short-textbox" name="DepSICCode" type="text" value="@Model.DepSICCode" readonly="readonly"/></td>
				</tr>
				
				<tr><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td></tr>
				<TR>
					<TD>Lead Contact</TD>
					<TD><input type="hidden" name="ContactID" value="@Model.LeadContactID" /><input class="lookup-textbox" type="text" name="ContactName" readonly="readonly" value="@(Model.LeadContactID==null?"":Model.Contact.FirstName)" /> <a onclick="AddrLookUp('AddDirectorate', 'ContactID', 'ContactName')" class="link" style="color:Blue">Lookup</a></TD>
					<TD rowspan=2>Department Full Description</TD>
					<TD rowspan=2><textarea class="standar-textarea" name="DepFullDescription">@Html.DisplayFor(model => model.DepFullDescription)</textarea></TD>
				</TR>
				<TR>
					<TD>Copy Address from</TD>
					<TD>
                    <input type="hidden" name="OrgAddr1" value="@ViewBag.OrgAddr1" />
                    <input type="hidden" name="OrgAddr2" value="@ViewBag.OrgAddr2" />
                    <input type="hidden" name="OrgAddr3" value="@ViewBag.OrgAddr3" />
                    <input type="hidden" name="OrgCode" value="@ViewBag.OrgCode" />
                    <input type="hidden" name="OrgTown" value="@ViewBag.OrgTown" />
                    <input type="hidden" name="OrgCounty" value="@ViewBag.OrgCounty" />
                    <input type="hidden" name="OrgCountry" value="@ViewBag.OrgCountry" />
                    <input type="radio" name="CopyAddr" onclick="CopyAddress()" />Organisation 
                    <input type="hidden" name="ParAddr1" value="@ViewBag.ParAddr1" />
                    <input type="hidden" name="ParAddr2" value="@ViewBag.ParAddr2" />
                    <input type="hidden" name="ParAddr3" value="@ViewBag.ParAddr3" />
                    <input type="hidden" name="ParCode" value="@ViewBag.ParCode" />
                    <input type="hidden" name="ParTown" value="@ViewBag.ParTown" />
                    <input type="hidden" name="ParCounty" value="@ViewBag.ParCounty" />
                    <input type="hidden" name="ParCountry" value="@ViewBag.ParCountry" />
                    <input type="radio" name="CopyAddr" onclick="CopyAddress()" />Parent</TD>
					
				</TR>	
				
				<tr>
					<td>Address Line 1&nbsp;<span style="color:red">*</span></td>
					<td><input class="standar-textbox" type="text" name="AddressLine1" onchange="ChangeAddr()" value="@Html.DisplayFor(model => model.DepAddr1)" /></td>
					<td>Phone Number</td>
					<td><input class="standar-textbox" type="text" name="PhoneNumber" value="@Html.DisplayFor(model => model.DepPhone)" /></td>
				</tr>
				
				<tr>
					<td>Address Line 2</td>
					<td><input class="standar-textbox" type="text" name="AddressLine2" onchange="ChangeAddr()" value="@Html.DisplayFor(model => model.DepAddr2)" /></td>
					<td>Fax</td>
					<td><input class="standar-textbox" type="text" name="Fax" value="@Html.DisplayFor(model => model.DepFax)" /></td>
				</tr>
				<tr>
					<td>Address Line 3</td>
					<td><input class="standar-textbox" type="text" name="AddressLine3" onchange="ChangeAddr()" value="@Html.DisplayFor(model => model.DepAddr3)" /></td>
					<td>Email</td>
					<td><input class="standar-textbox" type="text" name="Email" value="@Html.DisplayFor(model => model.DepEmail)" /></td>
				</tr>
				
				<tr>
					<td>Postcode</td>
					<td><input type="text" name="PostCode" value="@Html.DisplayFor(model => model.DepPostCode)" /><a onclick="PostCodeLookUp('PostCode','AddressLine1','CityTown','County','CountryID','ChangeAddr')" class="link" style="color:Blue">Lookup</a></td>
					<td>Web Address</td>
					<td><input class="standar-textbox" type="text" name="WebAddress" value="@Html.DisplayFor(model => model.DepWebAddr)" /></td>
				</tr>
				<tr>
					<td>Town/Village/City</td>
					<td><input class="standar-textbox" type="text" name="CityTown" onchange="ChangeAddr()" value="@Html.DisplayFor(model => model.CityTown)" /></td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
				<tr>
					<td>County</td>
					<td><input class="standar-textbox" type="text" name="County" onchange="ChangeAddr()" value="@Html.DisplayFor(model => model.County)" /></td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
				
				<tr>
					<td>Nation/Country</td>
					<td>
                    <select class="standar-dropdown" onchange="ChangeAddr()" name="CountryID">
                    <option></option>
                        @foreach (var country in ViewBag.ListCountry)
                        {
                                <option value="@country.CountryID" @if(Model.CountryID==@country.CountryID){ @("selected='selected'")}>@country.CountryName</option>
                        }
                        </select>
                    </td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
				
				
			</table>
			
			</div>
                </form>
            <div id="tabs-2">
                 @{ Html.RenderAction("ListTeam", "Department", new { id = Model.DepID });  }
            </div>
            <div class="error"></div>
		</div>
		</div>
	</div>
